#!/usr/bin/env node

// Dependencies
const namly = require("../lib")
    , log = require("emoji-logger")
    , clp = require("clp")
    , package = require("../package")
    ;

log.add(
    "available"
  , "whiteCheckMark"
  , "turquoise"
);

log.add(
    "unavailable"
  , "noEntry"
  , "carrot"
);

log.add(
    "loading"
  , "hourglassFlowingSand"
  , "concrete"
  , 1
);

// Parse the command line arguments
var inputOpt = new clp.Option(["i", "input"], "The package keyword. \nCan be passed as single argument.", "keyword")
  , parser = new clp(process.argv.slice(2), {
        name: "Namly"
      , version: package.version
      , exe: package.name
      , examples: [
            "namly name",
            "namly -i name"
        ]
      , docs_url: package.homepage
      , process: true
    }, [
        inputOpt
    ])
  ;

inputOpt.value = (inputOpt.value || parser.process()._[0] || "").trim();
if (!inputOpt.value) {
    return log("The input keyword is mandatory.", "error");
}

log("Fetching the data... This may take a while.", "loading");
namly(inputOpt.value, (err, data) => {
    if (err) {
        if (Array.isArray(err)) {
            return err.forEach(c => c && log(c.toString(), "error"));
        }
        return log(err.message, "error");
    }
    data.forEach(c => log(c.name, c.available ? "available" : "unavailable"));
});
